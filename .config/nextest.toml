# Nextest configuration for ahma_mcp
#
# All profiles use immediate output by default for better CI diagnostics
# and to avoid buffering issues with subprocess-spawning tests.

[profile.default]
# Default timeout is 60s
slow-timeout = { period = "60s", terminate-after = 2 }
# Use reasonable retry settings
retries = 0
# Show output immediately - improves debugging and prevents issues with subprocess tests
failure-output = "immediate"
success-output = "immediate"

# CI profile with similar optimizations but may have different retry settings
[profile.ci]
retries = 1
slow-timeout = { period = "120s", terminate-after = 2 }
# Limit parallelism on CI to reduce resource contention
# GitHub Actions runners have 2 cores; use more conservative parallelism
test-threads = "num-cpus"
# Show output immediately for better CI diagnostics
failure-output = "immediate"
success-output = "immediate"

# Timing-sensitive handshake tests benefit from reduced parallelism
# These tests rely on precise timing (waiting for timeout expiration)
[[profile.ci.overrides]]
filter = "test(handshake_timeout_test::)"
threads-required = 2
retries = 2

# Coverage profile for cargo llvm-cov (instrumentation makes tests much slower)
[profile.coverage]
retries = 0
slow-timeout = { period = "1800s", terminate-after = 2 }
# Show output immediately - critical for coverage builds where subprocess tests can timeout
failure-output = "immediate"
success-output = "immediate"
