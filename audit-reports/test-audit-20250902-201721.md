# Test Quality Audit Report

**Generated:** 2025-09-02 20:17:51
**Workspace:** /Users/paul/github/ahma_mcp
**Git Branch:** feature/path-lock
**Git Commit:** 50a65cc

## Executive Summary

## Test Count Analysis

### Tests per Crate
```
```

**Total Tests:** 0

## Test Performance Analysis

### Execution Time
```
Skipping performance run (nextest or timeout not available)
```

## Coverage Analysis

### Overall Coverage
```
info: cargo-llvm-cov currently setting cfg(coverage); you can opt-out it by passing --no-cfg-coverage
   Compiling ahma_mcp v0.2.0 (/Users/paul/github/ahma_mcp)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 15.31s
────────────
 Nextest run ID 0c0231e6-b440-427c-8469-81d7d4726524 with nextest profile: default
    Starting 89 tests across 26 binaries
        PASS [   0.019s] ahma_mcp constants::tests::templates_include_placeholders
        PASS [   0.022s] ahma_mcp constants::tests::async_addendum_contains_key_guidance
        PASS [   0.022s] ahma_mcp callback_system::tests::test_channel_callback
        PASS [   0.021s] ahma_mcp operation_monitor::tests::test_wait_for_nonexistent_operation
        PASS [   0.022s] ahma_mcp callback_system::tests::test_no_op_callback
        PASS [   0.024s] ahma_mcp schema_validation::tests::test_invalid_async_guidance
        PASS [   0.024s] ahma_mcp operation_monitor::tests::test_wait_for_fast_completion_race_condition
        PASS [   0.024s] ahma_mcp callback_system::tests::test_cancellation
        PASS [   0.018s] ahma_mcp schema_validation::tests::test_missing_required_fields
        PASS [   0.018s] ahma_mcp schema_validation::tests::test_synchronous_tool_validation
        PASS [   0.021s] ahma_mcp schema_validation::tests::test_valid_tool_config
        PASS [   0.023s] ahma_mcp schema_validation::tests::test_invalid_option_type
        PASS [   0.021s] ahma_mcp shell_pool::tests::test_shell_pool_manager_disabled
        PASS [   0.021s] ahma_mcp shell_pool::tests::test_shell_pool_creation
        PASS [   0.022s] ahma_mcp shell_pool::tests::test_shell_command_serialization
        PASS [   0.023s] ahma_mcp shell_pool::tests::test_shell_pool_config_defaults
        PASS [   0.011s] ahma_mcp test::test_utils::tests::includes_whitespace_normalized
        PASS [   0.017s] ahma_mcp terminal_output::tests::test_format_content
        PASS [   0.014s] ahma_mcp test::test_utils::tests::includes_debug_escaped_newlines
        PASS [   0.016s] ahma_mcp terminal_output::tests::test_should_display
        PASS [   0.014s] ahma_mcp test::test_utils::tests::includes_is_case_sensitive
        PASS [   0.014s] ahma_mcp test::test_utils::tests::includes_quotes_and_backslashes
        PASS [   0.016s] ahma_mcp test::test_utils::tests::includes_direct_substring
        PASS [   0.016s] ahma_mcp test::test_utils::tests::includes_absent_pattern_false
        PASS [   0.013s] ahma_mcp tool_hints::tests::preview_replaces_placeholders
        PASS [   0.011s] ahma_mcp utils::timestamp::tests::test_duration_zero
        PASS [   0.011s] ahma_mcp utils::timestamp::tests::test_format_current_time_is_valid_format
        PASS [   0.012s] ahma_mcp utils::timestamp::tests::test_format_time_end_of_day
        PASS [   0.013s] ahma_mcp utils::timestamp::tests::test_format_time_basic
        PASS [   0.012s] ahma_mcp utils::timestamp::tests::test_format_time_midnight
        PASS [   0.010s] ahma_mcp::continuous_update_test continuous_update_test::test_continuous_add_operations
        PASS [   0.014s] ahma_mcp::config_loading_test config_tests::test_config_loading
        PASS [   0.012s] ahma_mcp::continuous_update_test continuous_update_test::test_continuous_updates_dont_duplicate_history
        PASS [   0.011s] ahma_mcp::development_workflow_invariants_test documentation_requirements::test_required_documentation_exists
        PASS [   0.010s] ahma_mcp::development_workflow_invariants_test test_error_remediation_patterns_invariant
        PASS [   0.009s] ahma_mcp::development_workflow_invariants_test test_graceful_shutdown_timing_invariant
        PASS [   0.015s] ahma_mcp::development_workflow_invariants_test test_progressive_warning_percentages_invariant
        PASS [   0.015s] ahma_mcp::development_workflow_invariants_test test_json_tool_configuration_count_invariant
        PASS [   0.015s] ahma_mcp::development_workflow_invariants_test test_signal_handling_requirements_invariant
        PASS [   0.009s] ahma_mcp::development_workflow_invariants_test test_wait_timeout_bounds_invariant
        PASS [   0.013s] ahma_mcp::endless_notification_fix_test endless_notification_test::test_completed_operations_are_persistent_in_history
        PASS [   0.013s] ahma_mcp::endless_notification_fix_test endless_notification_test::test_multiple_operations_tracked_in_history
        PASS [   0.010s] ahma_mcp::endless_notification_fix_test endless_notification_test::test_notification_loop_simulation
        PASS [   0.122s] ahma_mcp::async_notification_debug async_notification_test::test_operation_completion_tracking
        PASS [   0.518s] ahma_mcp utils::timestamp::tests::test_duration_since_as_rounded_seconds
        PASS [   1.115s] ahma_mcp utils::timestamp::tests::test_duration_as_rounded_seconds
        PASS [   8.147s] ahma_mcp::freeform_args_test test_freeform_argument_passing_ls
        PASS [   9.215s] ahma_mcp::enhanced_wait_tool_test test_status_tool_functionality
        PASS [   9.214s] ahma_mcp::enhanced_wait_tool_test test_wait_tool_timeout_functionality
        PASS [   9.156s] ahma_mcp::enhanced_wait_tool_test test_wait_tool_with_tool_filter
        PASS [   9.210s] ahma_mcp::enhanced_wait_tool_test test_wait_tool_timeout_validation
        PASS [   0.017s] ahma_mcp::graceful_shutdown_test test_wait_tool_timeout_scenarios
        PASS [   0.017s] ahma_mcp::graceful_shutdown_test test_lock_file_remediation_suggestions
        PASS [   0.021s] ahma_mcp::graceful_shutdown_test test_graceful_shutdown_infrastructure
        PASS [   0.151s] ahma_mcp::full_system_integration_bug_test full_system_integration_bug_test::test_full_system_integration_single_notification
        PASS [   0.117s] ahma_mcp::full_system_integration_bug_test full_system_integration_bug_test::test_multiple_operations_system_integration
        PASS [   8.974s] ahma_mcp::freeform_args_test test_freeform_argument_passing_clippy
        PASS [   0.715s] ahma_mcp::json_tool_test test_json_tool_definition_loading
        PASS [   0.019s] ahma_mcp::mcp_server_reproduction_test mcp_server_reproduction_test::test_persistent_completion_history_behavior
        PASS [   0.016s] ahma_mcp::operation_id_reuse_bug_test operation_id_reuse_bug_test::test_duplicate_operation_id_scenario
        PASS [   0.756s] ahma_mcp::ls_tool_command_construction_test test_ls_tool_should_not_add_undefined_path_parameter
        PASS [   0.008s] ahma_mcp::operation_id_reuse_bug_test operation_id_reuse_bug_test::test_multiple_add_operation_calls
        PASS [   0.008s] ahma_mcp::operation_id_reuse_bug_test operation_id_reuse_bug_test::test_production_like_sequence
        PASS [   0.007s] ahma_mcp::operation_id_reuse_bug_test operation_id_reuse_bug_test::test_status_transition_edge_cases
        PASS [   0.730s] ahma_mcp::mcp_integration_tests test_list_tools
        PASS [   0.885s] ahma_mcp::ls_tool_command_construction_test test_ls_tool_with_valid_options
        PASS [   0.994s] ahma_mcp::ls_tool_command_construction_test test_ls_tool_executes_plain_ls_command
        PASS [   0.882s] ahma_mcp::mcp_integration_tests test_call_tool_basic
        PASS [   0.030s] ahma_mcp::race_condition_bug_test race_condition_bug_test::test_concurrent_completion_and_notification_simulation
        PASS [   0.030s] ahma_mcp::race_condition_bug_test race_condition_bug_test::test_race_condition_between_completion_and_clearing
        PASS [   0.030s] ahma_mcp::race_condition_bug_test race_condition_bug_test::test_multiple_notification_loops
        PASS [   0.010s] ahma_mcp::race_condition_bug_test race_condition_bug_test::test_update_status_after_clear_race_condition
        PASS [   0.078s] ahma_mcp::realistic_endless_notification_test realistic_endless_notification_test::test_multiple_operations_notification_behavior
        PASS [   0.080s] ahma_mcp::realistic_endless_notification_test realistic_endless_notification_test::test_realistic_notification_scenario_with_history
        PASS [  12.295s] ahma_mcp::clippy_test test_run_clippy
        PASS [  12.291s] ahma_mcp::clippy_test test_run_clippy_with_tests
        PASS [  23.393s] ahma_mcp::tool_loading_bug_test test_tools_are_loaded_after_json_migration
        PASS [  23.414s] ahma_mcp::tool_loading_bug_test test_specific_json_tool_functionality
        PASS [  25.300s] ahma_mcp::tool_behavior_consistency_test test_tool_descriptions_match_actual_behavior
        PASS [  25.642s] ahma_mcp::path_security_test test_path_validation_failure_absolute
        PASS [  25.641s] ahma_mcp::path_security_test test_path_validation_failure_relative
        PASS [   0.041s] ahma_mcp::tool_schema_validation_test test_all_tool_json_files_validate
        PASS [   0.021s] ahma_mcp::vscode_mcp_config_test test_vscode_mcp_config_watches_json_files
        PASS [   0.021s] ahma_mcp::vscode_mcp_config_test test_vscode_mcp_config_has_valid_command_structure
        PASS [  25.425s] ahma_mcp::tool_behavior_consistency_test test_ls_tool_command_structure
        PASS [  28.495s] ahma_mcp::path_security_test test_path_validation_success
        PASS [  29.274s] ahma_mcp::tool_behavior_consistency_test test_synchronous_cargo_check_returns_actual_results
        PASS [  10.369s] ahma_mcp::vscode_integration_bug_test test_vscode_tool_loading_scenario
        PASS [  10.382s] ahma_mcp::vscode_integration_bug_test test_vscode_dev_tool_loading_scenario
────────────
     Summary [  46.165s] 89 tests run: 89 passed, 0 skipped
warning: 5 functions have mismatched data
Filename                      Regions    Missed Regions     Cover   Functions  Missed Functions  Executed       Lines      Missed Lines     Cover    Branches   Missed Branches     Cover
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
adapter.rs                        400               234    41.50%          18                 9    50.00%         299               178    40.47%           0                 0         -
callback_system.rs                255               143    43.92%          30                15    50.00%         212               114    46.23%           0                 0         -
config.rs                          74                35    52.70%           4                 1    75.00%          45                23    48.89%           0                 0         -
constants.rs                       25                 0   100.00%           2                 0   100.00%          11                 0   100.00%           0                 0         -
main.rs                           356               356     0.00%          18                18     0.00%         208               208     0.00%           0                 0         -
mcp_callback.rs                    12                12     0.00%           4                 4     0.00%          10                10     0.00%           0                 0         -
mcp_service.rs                   1135              1127     0.70%          40                38     5.00%         747               734     1.74%           0                 0         -
operation_monitor.rs              261                63    75.86%          27                11    59.26%         201                47    76.62%           0                 0         -
schema_validation.rs              687               223    67.54%          28                 3    89.29%         628               186    70.38%           0                 0         -
shell_pool.rs                     774               337    56.46%          70                25    64.29%         549               197    64.12%           0                 0         -
terminal_output.rs                119                74    37.82%           6                 2    66.67%          68                38    44.12%           0                 0         -
test/test_utils.rs                141                 6    95.74%           9                 0   100.00%          79                 3    96.20%           0                 0         -
tool_hints.rs                      19                 0   100.00%           2                 0   100.00%          12                 0   100.00%           0                 0         -
utils/logging.rs                   43                43     0.00%           3                 3     0.00%          28                28     0.00%           0                 0         -
utils/timestamp.rs                164                 4    97.56%          11                 0   100.00%          75                 1    98.67%           0                 0         -
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
TOTAL                            4465              2657    40.49%         272               129    52.57%        3172              1767    44.29%           0                 0         -

Coverage generation completed (summary above).
```

## Test Health Analysis

### Common Test Patterns
```

```

### Potential Issues
```


```

## Quality Recommendations

### High Priority
- **Increase test coverage**: Current test count (0) is below recommended threshold (500+).

### Medium Priority
- Standardize test helpers and share where useful.
- Add property tests and more integration coverage for critical paths.

### Low Priority
- Add doctests for public APIs and consider benchmark suites.

## Audit Metadata

- **Audit Duration:** 00:01:44 (started: Tue Sep  2 20:17:21 EEST 2025)
- **Workspace State:** 11 uncommitted changes
- **Tool Versions:**
  - cargo: cargo 1.89.0 (c24e10642 2025-06-23)
  - nextest: not installed
  - llvm-cov: cargo-llvm-cov 0.6.18

---
*Generated by test-audit.sh*
